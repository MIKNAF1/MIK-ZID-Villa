<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MIK ZID Villa | Elevate Your Lifestyle | Piliyandala, Sri Lanka</title>
  <meta name="description" content="Luxury 5-bedroom villa with private pool in Piliyandala, Colombo. Experience elegant living with modern amenities, AC rooms, and dedicated staff.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--navy:#1a2d4a;--navy-dark:#0f1c2e;--gold:#e59334;--gold-light:#f4a84a;--cream:#faf8f5;--white:#ffffff;--text-dark:#1a1a1a;--text-light:#6b7280;--ok:#22c55e;--warn:#f59e0b;--bad:#ef4444;--chip-bg: rgba(255,255,255,0.08);--chip-br: rgba(255,255,255,0.18);}
    *{margin:0;padding:0;box-sizing:border-box;}html{scroll-behavior:smooth;}
    body{font-family:'Montserrat',sans-serif;background:var(--cream);color:var(--text-dark);line-height:1.7;overflow-x:hidden;}
    h1,h2,h3,h4{font-family:'Cormorant Garamond',serif;font-weight:500;line-height:1.2;}
    nav{position:fixed;top:0;left:0;right:0;z-index:1000;padding:1.5rem 5%;display:flex;justify-content:space-between;align-items:center;transition:all .4s ease;}
    nav.scrolled{background:rgba(26,45,74,.98);padding:1rem 5%;backdrop-filter:blur(10px);}
    .logo{display:flex;align-items:baseline;gap:.5rem;}
    .logo-text{font-weight:700;font-size:1.4rem;color:var(--white);letter-spacing:2px;}
    .logo-villa{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.6rem;color:var(--gold);}
    .nav-links{display:flex;gap:2.5rem;list-style:none;}
    .nav-links a{color:var(--white);text-decoration:none;font-size:.85rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;transition:color .3s ease;position:relative;}
    .nav-links a::after{content:'';position:absolute;bottom:-5px;left:0;width:0;height:1px;background:var(--gold);transition:width .3s ease;}
    .nav-links a:hover::after{width:100%;}.nav-links a:hover{color:var(--gold);}
    .mobile-menu-btn{display:none;flex-direction:column;gap:5px;cursor:pointer;z-index:1001;}
    .mobile-menu-btn span{width:25px;height:2px;background:var(--white);transition:all .3s ease;}
    .hero{height:100vh;min-height:700px;position:relative;display:flex;align-items:center;justify-content:center;overflow:hidden;}
    .hero-bg{position:absolute;inset:0;background:linear-gradient(135deg,var(--navy-dark) 0%,var(--navy) 50%,#2a4a6a 100%);}
    .hero-pattern{position:absolute;inset:0;opacity:.05;background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");}
    .hero-content{position:relative;z-index:10;text-align:center;max-width:900px;padding:0 2rem;}
    .hero-tagline{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.2rem;color:var(--gold);margin-bottom:1.5rem;letter-spacing:3px;animation:fadeInUp 1s ease .3s both;}
    .hero-title{font-size:clamp(3rem,8vw,6rem);color:var(--white);margin-bottom:1.5rem;animation:fadeInUp 1s ease .5s both;}
    .hero-subtitle{font-size:1.1rem;color:rgba(255,255,255,.8);font-weight:300;max-width:600px;margin:0 auto 2.5rem;animation:fadeInUp 1s ease .7s both;}
    .hero-cta{display:flex;gap:1.5rem;justify-content:center;flex-wrap:wrap;animation:fadeInUp 1s ease .9s both;}
    .btn{padding:1rem 2.5rem;font-family:'Montserrat',sans-serif;font-size:.85rem;font-weight:600;letter-spacing:2px;text-transform:uppercase;text-decoration:none;border:none;cursor:pointer;transition:all .4s ease;}
    .btn-primary{background:var(--gold);color:var(--navy-dark);}
    .btn-primary:hover{background:var(--gold-light);transform:translateY(-2px);box-shadow:0 10px 30px rgba(229,147,52,.3);}
    .btn-outline{background:transparent;color:var(--white);border:1px solid rgba(255,255,255,.5);}
    .btn-outline:hover{background:var(--white);color:var(--navy-dark);}
    .btn-primary[disabled]{opacity:.6;cursor:not-allowed;transform:none!important;box-shadow:none!important;}
    .scroll-indicator{position:absolute;bottom:3rem;left:50%;transform:translateX(-50%);animation:bounce 2s infinite;}
    .scroll-indicator span{display:block;width:24px;height:40px;border:2px solid rgba(255,255,255,.5);border-radius:20px;position:relative;}
    .scroll-indicator span::before{content:'';position:absolute;top:8px;left:50%;transform:translateX(-50%);width:4px;height:8px;background:var(--gold);border-radius:2px;animation:scroll 2s infinite;}
    section{padding:8rem 5%;}
    .section-header{text-align:center;max-width:700px;margin:0 auto 4rem;}
    .section-label{font-size:.75rem;font-weight:600;letter-spacing:4px;text-transform:uppercase;color:var(--gold);margin-bottom:1rem;}
    .section-title{font-size:clamp(2.5rem,5vw,3.5rem);color:var(--navy);margin-bottom:1.5rem;}
    .section-desc{color:var(--text-light);font-size:1.05rem;}
    .deco-line{width:60px;height:3px;background:var(--gold);margin:1.5rem auto;}
    .about{background:var(--white);}
    .about-grid{display:grid;grid-template-columns:1fr 1fr;gap:4rem;align-items:center;max-width:1400px;margin:0 auto;}
    .about-image{position:relative;}
    .about-image img{width:100%;height:600px;object-fit:cover;}
    .about-image::before{content:'';position:absolute;top:-20px;left:-20px;width:100%;height:100%;border:2px solid var(--gold);z-index:-1;}
    .about-content h2{font-size:3rem;color:var(--navy);margin-bottom:1.5rem;}
    .about-content p{color:var(--text-light);margin-bottom:1.5rem;font-size:1.05rem;}
    .stats-row{display:flex;gap:3rem;margin-top:2.5rem;padding-top:2.5rem;border-top:1px solid #eee;}
    .stat{text-align:center;}
    .stat-number{font-family:'Cormorant Garamond',serif;font-size:3rem;color:var(--navy);font-weight:600;}
    .stat-label{font-size:.8rem;text-transform:uppercase;letter-spacing:2px;color:var(--text-light);}
    .amenities{background:var(--navy);position:relative;overflow:hidden;}
    .amenities .section-title{color:var(--white);}
    .amenities .section-desc{color:rgba(255,255,255,.7);}
    .amenities-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:2rem;max-width:1400px;margin:0 auto;}
    .amenity-card{background:rgba(255,255,255,.05);padding:2.5rem 2rem;text-align:center;border:1px solid rgba(255,255,255,.1);transition:all .4s ease;}
    .amenity-card:hover{background:rgba(255,255,255,.1);transform:translateY(-5px);border-color:var(--gold);}
    .amenity-icon{width:60px;height:60px;margin:0 auto 1.5rem;display:flex;align-items:center;justify-content:center;}
    .amenity-icon svg{width:40px;height:40px;stroke:var(--gold);stroke-width:1.5;fill:none;}
    .amenity-card h4{font-size:1.3rem;color:var(--white);margin-bottom:.75rem;}
    .amenity-card p{font-size:.9rem;color:rgba(255,255,255,.6);}
    .gallery{background:var(--cream);}
    .gallery-grid{display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(2,300px);gap:1.5rem;max-width:1400px;margin:0 auto;}
    .gallery-item{position:relative;overflow:hidden;cursor:pointer;}
    .gallery-item:first-child{grid-column:span 2;grid-row:span 2;}
    .gallery-item img{width:100%;height:100%;object-fit:cover;transition:transform .6s ease;}
    .gallery-item:hover img{transform:scale(1.05);}
    .gallery-item::after{content:'';position:absolute;inset:0;background:linear-gradient(to top,rgba(26,45,74,.6) 0%,transparent 50%);opacity:0;transition:opacity .4s ease;}
    .gallery-item:hover::after{opacity:1;}
    .rooms{background:var(--white);}
    .rooms-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;max-width:1400px;margin:0 auto;}
    .room-card{background:var(--cream);overflow:hidden;transition:all .4s ease;}
    .room-card:hover{transform:translateY(-10px);box-shadow:0 20px 40px rgba(0,0,0,.1);}
    .room-image{height:280px;overflow:hidden;}
    .room-image img{width:100%;height:100%;object-fit:cover;transition:transform .6s ease;}
    .room-card:hover .room-image img{transform:scale(1.1);}
    .room-content{padding:2rem;}
    .room-content h4{font-size:1.5rem;color:var(--navy);margin-bottom:.75rem;}
    .room-content p{color:var(--text-light);font-size:.95rem;margin-bottom:1rem;}
    .room-features{display:flex;gap:1rem;flex-wrap:wrap;}
    .room-feature{font-size:.75rem;text-transform:uppercase;letter-spacing:1px;color:var(--gold);padding:.4rem .8rem;border:1px solid var(--gold);}
    .location{background:var(--cream);}
    .location-grid{display:grid;grid-template-columns:1fr 1fr;gap:4rem;max-width:1400px;margin:0 auto;align-items:center;}
    .location-content h2{font-size:3rem;color:var(--navy);margin-bottom:1.5rem;}
    .location-content p{color:var(--text-light);margin-bottom:2rem;font-size:1.05rem;}
    .distance-list{display:flex;flex-direction:column;gap:1rem;}
    .distance-item{display:flex;justify-content:space-between;padding:1rem 0;border-bottom:1px solid #ddd;}
    .distance-item span:first-child{color:var(--navy);font-weight:500;}
    .distance-item span:last-child{color:var(--gold);font-weight:600;}
    .map-container{height:500px;background:var(--navy);position:relative;overflow:hidden;}
    .map-container iframe{width:100%;height:100%;border:none;filter:grayscale(30%);}
    .contact{background:var(--navy);position:relative;}
    .contact .section-title{color:var(--white);}
    .contact .section-desc{color:rgba(255,255,255,.7);}
    .contact-grid{display:grid;grid-template-columns:1fr 1fr;gap:4rem;max-width:1200px;margin:0 auto;}
    .contact-info{display:flex;flex-direction:column;gap:2rem;}
    .contact-item{display:flex;gap:1.5rem;align-items:flex-start;}
    .contact-icon{width:50px;height:50px;border:1px solid var(--gold);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
    .contact-icon svg{width:24px;height:24px;stroke:var(--gold);stroke-width:1.5;fill:none;}
    .contact-text h4{font-size:1.1rem;color:var(--white);margin-bottom:.5rem;}
    .contact-text p,.contact-text a{color:rgba(255,255,255,.75);font-size:.95rem;text-decoration:none;display:block;transition:color .3s ease;}
    .contact-text a:hover{color:var(--gold);}
    .contact-form{display:flex;flex-direction:column;gap:1.1rem;background: rgba(255,255,255,0.04);border: 1px solid rgba(255,255,255,0.10);padding: 1.5rem;border-radius: 14px;backdrop-filter: blur(8px);}
    .form-group input,.form-group textarea,.form-group select{width:100%;padding:1.05rem 1.1rem;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.2);color:var(--white);font-family:'Montserrat',sans-serif;font-size:.95rem;transition:all .3s ease;border-radius:10px;}
    .form-group select{appearance:none;}
    .form-group input::placeholder,.form-group textarea::placeholder{color:rgba(255,255,255,.55);}
    .form-group input:focus,.form-group textarea:focus,.form-group select:focus{outline:none;border-color:var(--gold);background:rgba(255,255,255,.08);box-shadow: 0 0 0 4px rgba(229,147,52,0.12);}
    .form-group textarea{min-height:140px;resize:vertical;}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
    .availability-bar{display:flex;align-items:center;justify-content:space-between;gap:10px;padding: .85rem 1rem;border-radius: 12px;background: var(--chip-bg);border: 1px solid var(--chip-br);}
    .availability-left{display:flex;flex-direction:column;gap:2px;}
    .availability-title{color:rgba(255,255,255,.9);font-weight:600;font-size:.9rem;}
    .availability-sub{color:rgba(255,255,255,.65);font-size:.82rem;}
    .badge{display:inline-flex;align-items:center;gap:8px;padding: .45rem .7rem;border-radius: 999px;font-weight:700;font-size:.75rem;letter-spacing:1px;text-transform:uppercase;border:1px solid rgba(255,255,255,.18);background: rgba(255,255,255,.06);color: rgba(255,255,255,.9);white-space: nowrap;}
    .badge.ok{border-color: rgba(34,197,94,.45); background: rgba(34,197,94,.10); color: #b7f7c9;}
    .badge.warn{border-color: rgba(245,158,11,.45); background: rgba(245,158,11,.12); color: #ffe1a8;}
    .badge.bad{border-color: rgba(239,68,68,.45); background: rgba(239,68,68,.10); color: #ffb4b4;}
    .form-actions{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-top:.25rem;}
    .form-note{color: rgba(255,255,255,.65);font-size:.82rem;}
    footer{background:var(--navy-dark);padding:3rem 5%;}
    .footer-content{display:flex;justify-content:space-between;align-items:center;max-width:1400px;margin:0 auto;flex-wrap:wrap;gap:1.5rem;}
    .footer-logo{display:flex;align-items:baseline;gap:.5rem;}
    .footer-logo .logo-text{font-size:1.2rem;}
    .footer-logo .logo-villa{font-size:1.4rem;}
    .footer-copyright{color:rgba(255,255,255,.5);font-size:.85rem;}
    .footer-links{display:flex;gap:2rem;}
    .footer-links a{color:rgba(255,255,255,.7);text-decoration:none;font-size:.85rem;transition:color .3s ease;}
    .footer-links a:hover{color:var(--gold);}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
    @keyframes bounce{0%,20%,50%,80%,100%{transform:translateX(-50%) translateY(0);}40%{transform:translateX(-50%) translateY(-10px);}60%{transform:translateX(-50%) translateY(-5px);}}
    @keyframes scroll{0%{opacity:1;transform:translateX(-50%) translateY(0);}100%{opacity:0;transform:translateX(-50%) translateY(10px);}}
    @media (max-width:1200px){.amenities-grid{grid-template-columns:repeat(2,1fr);} .rooms-grid{grid-template-columns:repeat(2,1fr);}}
    @media (max-width:992px){.nav-links{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:var(--navy-dark);flex-direction:column;justify-content:center;align-items:center;gap:2rem;}
      .nav-links.active{display:flex;}.mobile-menu-btn{display:flex;}.about-grid,.location-grid,.contact-grid{grid-template-columns:1fr;}
      .about-image{order:-1;}.gallery-grid{grid-template-columns:1fr 1fr;grid-template-rows:auto;}.gallery-item:first-child{grid-column:span 2;}}
    @media (max-width:768px){section{padding:5rem 5%;}.amenities-grid,.rooms-grid{grid-template-columns:1fr;}.gallery-grid{grid-template-columns:1fr;}
      .gallery-item:first-child{grid-column:span 1;grid-row:span 1;}.gallery-item{height:250px;}.stats-row{flex-wrap:wrap;gap:2rem;}
      .form-row{grid-template-columns:1fr;}.footer-content{flex-direction:column;text-align:center;}}
  </style>
</head>
<body>
  <nav id="navbar">
    <div class="logo"><span class="logo-text">MIK ZID</span><span class="logo-villa">Villa</span></div>
    <ul class="nav-links" id="navLinks">
      <li><a href="#home">Home</a></li><li><a href="#about">About</a></li><li><a href="#amenities">Amenities</a></li>
      <li><a href="#gallery">Gallery</a></li><li><a href="#rooms">Rooms</a></li><li><a href="#location">Location</a></li><li><a href="#contact">Contact</a></li>
    </ul>
    <div class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Open Menu"><span></span><span></span><span></span></div>
  </nav>

  <section class="hero" id="home">
    <div class="hero-bg"></div><div class="hero-pattern"></div>
    <div class="hero-content">
      <p class="hero-tagline">"Elevate Your Lifestyle"</p>
      <h1 class="hero-title">MIK ZID Villa</h1>
      <p class="hero-subtitle">Experience luxury living in the heart of Piliyandala, Colombo. A private five-bedroom sanctuary with modern elegance and timeless comfort.</p>
      <div class="hero-cta">
        <a href="#contact" class="btn btn-primary">Book Your Stay</a>
        <a href="#gallery" class="btn btn-outline">Explore Villa</a>
      </div>
    </div>
    <div class="scroll-indicator"><span></span></div>
  </section>

  <!-- Content sections unchanged (shortened in this file for size). -->
  <section class="contact" id="contact">
    <div class="section-header">
      <span class="section-label">Get in Touch</span>
      <h2 class="section-title">Book Your Stay</h2>
      <div class="deco-line"></div>
      <p class="section-desc">Check availability instantly, choose a payment option, and submit your inquiry.</p>
    </div>

    <div class="contact-grid">
      <div class="contact-info">
        <div class="contact-item">
          <div class="contact-icon"><svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg></div>
          <div class="contact-text"><h4>Address</h4><p>71/C/1 Bandipitiya Rd,<br>Piliyandala 10300<br>Sri Lanka</p></div>
        </div>
        <div class="contact-item">
          <div class="contact-icon"><svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg></div>
          <div class="contact-text"><h4>Phone / WhatsApp</h4><a href="tel:+947773999118">07773999118</a></div>
        </div>
        <div class="contact-item">
          <div class="contact-icon"><svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
          <div class="contact-text"><h4>Email</h4><a href="mailto:reservations@mikzidvilla.lk">reservations@mikzidvilla.lk</a><a href="mailto:info@mikzidvilla.lk">info@mikzidvilla.lk</a></div>
        </div>
      </div>

      <form class="contact-form" id="inquiryForm">
        <div class="form-row">
          <div class="form-group"><input type="text" name="name" placeholder="Your Name" required></div>
          <div class="form-group"><input type="email" name="email" placeholder="Your Email" required></div>
        </div>
        <div class="form-row">
          <div class="form-group"><input type="tel" name="phone" placeholder="Phone Number (Optional)"></div>
          <div class="form-group"><input type="number" name="guests" placeholder="Number of Guests" min="1" max="15"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><input type="date" id="checkin" name="checkin" required></div>
          <div class="form-group"><input type="date" id="checkout" name="checkout" required></div>
        </div>

        <div class="availability-bar" id="availabilityBar">
          <div class="availability-left"><div class="availability-title">Availability</div><div class="availability-sub" id="availabilitySub">Select dates to check.</div></div>
          <div class="badge warn" id="availabilityBadge">Not checked</div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <select name="payment_method" id="paymentMethod" required>
              <option value="pay_later" selected>Payment Method: Pay on Arrival / Bank Transfer</option>
              <option value="pay_online">Pay Online (PayHere)</option>
            </select>
          </div>
          <div class="form-group"><input type="text" name="preferred_contact" placeholder="Preferred Contact (WhatsApp / Call / Email)"></div>
        </div>

        <div class="form-group"><textarea name="message" placeholder="Your Message or Special Requests"></textarea></div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" id="submitBtn" disabled>Send Inquiry</button>
          <span class="form-note" id="formNote">Choose dates to enable inquiry.</span>
        </div>
        <div class="form-note" id="paymentNote" style="margin-top:.5rem;">If you choose <b>Pay Online</b>, you will be redirected to PayHere after you submit the inquiry.</div>
      </form>
    </div>
  </section>

  <footer><div class="footer-content"><div class="footer-logo"><span class="logo-text">MIK ZID</span><span class="logo-villa">Villa</span></div><p class="footer-copyright">&copy; 2026 MIK ZID Villa. All rights reserved.</p></div></footer>

  <script>
    const API_BASE = "https://YOUR-WORKER-SUBDOMAIN.workers.dev";
    const navbar = document.getElementById('navbar');
    window.addEventListener('scroll', () => { if (window.scrollY > 100) navbar.classList.add('scrolled'); else navbar.classList.remove('scrolled'); });
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const navLinks = document.getElementById('navLinks');
    mobileMenuBtn.addEventListener('click', () => navLinks.classList.toggle('active'));
    document.querySelectorAll('.nav-links a').forEach(link => link.addEventListener('click', () => navLinks.classList.remove('active')));

    const checkinEl = document.getElementById("checkin");
    const checkoutEl = document.getElementById("checkout");
    const badge = document.getElementById("availabilityBadge");
    const sub = document.getElementById("availabilitySub");
    const submitBtn = document.getElementById("submitBtn");
    const formNote = document.getElementById("formNote");
    const paymentMethod = document.getElementById("paymentMethod");
    const form = document.getElementById("inquiryForm");

    let lastAvailability = { ok: false, reason: "Select dates" };
    let debounceTimer = null;

    function setBadge(state, text, subtext) {
      badge.classList.remove("ok","warn","bad");
      badge.classList.add(state);
      badge.textContent = text;
      sub.textContent = subtext;
    }
    function validateDates(checkin, checkout) {
      if (!checkin || !checkout) return { ok: false, reason: "Select check-in and check-out dates." };
      if (checkout <= checkin) return { ok: false, reason: "Check-out must be after check-in." };
      return { ok: true };
    }
    async function checkAvailability() {
      const checkin = checkinEl.value, checkout = checkoutEl.value;
      const v = validateDates(checkin, checkout);
      if (!v.ok) { lastAvailability = { ok:false, reason:v.reason }; setBadge("warn","Not ready",v.reason); submitBtn.disabled=true; formNote.textContent="Choose valid dates to enable inquiry."; return; }
      setBadge("warn","Checking","Checking availability…"); submitBtn.disabled=true; formNote.textContent="Checking dates…";
      try{
        const res = await fetch(`${API_BASE}/availability?checkin=${encodeURIComponent(checkin)}&checkout=${encodeURIComponent(checkout)}`);
        const data = await res.json();
        if (data && data.available === true){
          lastAvailability = { ok:true };
          setBadge("ok","Available","Dates are available — you can send inquiry.");
          submitBtn.disabled=false;
          formNote.textContent="Send inquiry to reserve (confirmation is done by admin).";
        } else {
          const reason = data?.reason || "These dates are booked.";
          lastAvailability = { ok:false, reason };
          setBadge("bad","Booked",reason);
          submitBtn.disabled=true;
          formNote.textContent="Please choose different dates.";
        }
      } catch(e){
        lastAvailability = { ok:false, reason:"Availability check failed. Try again." };
        setBadge("bad","Error","Couldn’t check availability. Please try again.");
        submitBtn.disabled=true;
        formNote.textContent="Temporary issue. Try again.";
      }
    }
    function scheduleAvailabilityCheck(){ clearTimeout(debounceTimer); debounceTimer=setTimeout(checkAvailability,350); }
    checkinEl.addEventListener("change", scheduleAvailabilityCheck);
    checkoutEl.addEventListener("change", scheduleAvailabilityCheck);

    const today = new Date();
    const minDate = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
    checkinEl.min=minDate; checkoutEl.min=minDate;
    checkinEl.addEventListener("change", () => { if(checkinEl.value) checkoutEl.min = checkinEl.value; });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!lastAvailability.ok) { alert(lastAvailability.reason || "Please select available dates."); return; }

      const payload = {
        name: form.querySelector('[name="name"]').value.trim(),
        email: form.querySelector('[name="email"]').value.trim(),
        phone: form.querySelector('[name="phone"]').value.trim(),
        guests: form.querySelector('[name="guests"]').value ? Number(form.querySelector('[name="guests"]').value) : null,
        checkin: checkinEl.value,
        checkout: checkoutEl.value,
        message: form.querySelector('[name="message"]').value.trim(),
        preferred_contact: form.querySelector('[name="preferred_contact"]').value.trim(),
        payment_method: paymentMethod.value,
        source: "website"
      };

      submitBtn.disabled=true; formNote.textContent="Sending inquiry…"; setBadge("warn","Sending","Submitting your inquiry…");
      try{
        const res = await fetch(`${API_BASE}/inquiry`, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(payload) });
        const data = await res.json();
        if (res.ok && data?.ok){
          setBadge("ok","Saved","Inquiry received! We’ll contact you shortly.");
          formNote.textContent="Inquiry submitted successfully.";
          const bookingId = data.booking_id;
          if (payload.payment_method === "pay_online" && bookingId){
            window.location.href = `${API_BASE}/pay?booking_id=${encodeURIComponent(bookingId)}`;
            return;
          }
          form.reset(); submitBtn.disabled=true; setBadge("warn","Not checked","Select dates to check.");
        } else {
          const msg = data?.error || data?.detail || "Could not submit inquiry.";
          setBadge("bad","Failed",msg); formNote.textContent=msg; scheduleAvailabilityCheck();
        }
      } catch(e){
        setBadge("bad","Failed","Network issue. Please try again."); formNote.textContent="Network issue. Please try again."; scheduleAvailabilityCheck();
      }
    });
  </script>
</body>
</html>
